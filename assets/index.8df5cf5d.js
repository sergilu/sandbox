var W=Object.defineProperty,O=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var g=(a,t,e)=>t in a?W(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,D=(a,t)=>{for(var e in t||(t={}))S.call(t,e)&&g(a,e,t[e]);if(C)for(var e of C(t))T.call(t,e)&&g(a,e,t[e]);return a},P=(a,t)=>O(a,A(t));var r=(a,t,e)=>(g(a,typeof t!="symbol"?t+"":t,e),e);const L=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}};L();const N=800,k=800,b=100,I=100;function H(){const a=document.querySelector("#sandbox"),t=new R(a,N,k,b,I);new B(t).start()}class V{constructor(t,e,n){r(this,"x");r(this,"y");r(this,"value");this.x=t,this.y=e,this.value=n}}class d{constructor(t,e,n){r(this,"height");r(this,"width");r(this,"matrix");r(this,"fillValue");this.height=t,this.width=e,this.fillValue=n,this.matrix=d.createMatrix(t,e,n)}static createMatrix(t,e,n){return Array.from(Array(t)).map(()=>Array.from(Array(e).fill(n)))}get(t,e){var n,s,i;return(i=(s=(n=this.matrix)==null?void 0:n[e])==null?void 0:s[t])!=null?i:null}set(t,e,n){this.get(t,e)!=null&&(this.matrix[e][t]=n)}getPoints(){return this.matrix.map((e,n)=>e.map((s,i)=>new V(i,n,s))).flat()}setPoints(t){t.forEach(e=>this.matrix[e.y][e.x]=e.value)}map(t){const e=new d(this.height,this.width,null);return e.setPoints(this.getPoints().map(n=>new V(n.x,n.y,t(n.value,n.x,n.y)))),e}forEach(t){this.getPoints().forEach(e=>t(e.value,e.x,e.y))}copy(){const t=new d(this.height,this.width,this.fillValue);return t.setPoints(this.getPoints()),t}}class v{constructor(t,e=100,n=50){r(this,"hue");r(this,"saturation");r(this,"lightness");this.hue=t,this.saturation=e,this.lightness=n}toCss(){return`hsl(${this.hue}, ${this.saturation}%, ${this.lightness}%`}}class R{constructor(t,e,n,s,i){r(this,"height");r(this,"width");r(this,"ctx");r(this,"_onClick",()=>{});r(this,"fps",0);r(this,"maxFps",30);r(this,"pixelHeight");r(this,"pixelWidth");r(this,"lastCalledTime");r(this,"selectedMouseButtonType",0);r(this,"handleCanvasMouseMove",t=>{const e=this.adaptMouseEvent(t);this._onClick(e.offsetX,e.offsetY,this.selectedMouseButtonType)});t.height=e,t.width=n,this.height=s,this.width=i,this.pixelHeight=Math.floor(e/s),this.pixelWidth=Math.floor(n/i),this.ctx=t.getContext("2d"),this.lastCalledTime=performance.now(),this.initEvents()}setPixel(t,e,n){this.ctx.fillStyle=n.toCss(),this.ctx.fillRect(t*this.pixelWidth,e*this.pixelHeight,this.pixelWidth,this.pixelHeight)}paintMatrix(t){t.getPoints().forEach(e=>this.setPixel(e.x,e.y,e.value)),window.requestAnimationFrame(()=>this.updateFps())}updateFps(){const t=(Date.now()-this.lastCalledTime)/1e3;this.lastCalledTime=performance.now(),this.fps=1/t}initEvents(){this.ctx.canvas.addEventListener("mousedown",t=>{this.selectedMouseButtonType=t.button;const e=Math.floor(t.offsetX/this.pixelWidth),n=Math.floor(t.offsetY/this.pixelHeight);this._onClick(e,n,this.selectedMouseButtonType),this.startDrawing()}),this.ctx.canvas.addEventListener("mouseup",()=>{this.stopDrawing()}),this.ctx.canvas.addEventListener("mouseleave",()=>{this.stopDrawing()}),this.ctx.canvas.addEventListener("contextmenu",t=>{t.preventDefault()})}startDrawing(){this.ctx.canvas.addEventListener("mousemove",this.handleCanvasMouseMove,!1)}stopDrawing(){this.ctx.canvas.removeEventListener("mousemove",this.handleCanvasMouseMove,!1)}adaptMouseEvent(t){return P(D({},t),{offsetX:Math.floor(t.offsetX/this.pixelWidth),offsetY:Math.floor(t.offsetY/this.pixelHeight)})}onClick(t){this._onClick=t}}class B{constructor(t){r(this,"isPlaying",!0);r(this,"display");r(this,"matrix");r(this,"universe",new X);r(this,"fps",30);r(this,"velocity",1);this.display=t,this.matrix=new d(t.height,t.width,h.createVoid()),this.display.onClick((e,n,s)=>{switch(s){case 0:this.setAtom(e,n,new h(l.SAND),1);break;case 1:this.setAtom(e,n,new h(l.VOID));break;case 2:this.setAtom(e,n,new h(l.WATER),2);break}})}setAtom(t,e,n,s=0){for(let i=t-s;i<t+s+1;i++)for(let o=e-s;o<e+s+1;o++)this.matrix.set(i,o,n)}start(){setInterval(()=>this.displayNextState(),1e3/this.fps)}displayNextState(){for(let t=0;t<this.velocity;t++)this.matrix=this.universe.nextState(this.matrix);this.displayMatrix(this.matrix)}pause(){this.isPlaying=!1}displayMatrix(t){this.display.paintMatrix(t.map(this.atomToPixel))}atomToPixel(t){switch(t.type){case l.SAND:return new v(51,66,76);case l.WATER:return new v(199,80,68);case l.VOID:default:return new v(0,0,0)}}}class X{nextState(t){const e=t.copy();return t.forEach((n,s,i)=>{var w,x,m,M,E,y;if(!n||n.isEmpty())return;const o=t.get(s,i+1);if(o==null){e.get(s,i)==null&&e.set(s,i,n);return}if(o.isEmpty()){e.set(s,i,(w=e.get(s,i+1))!=null?w:h.createVoid()),e.set(s,i+1,n);return}const f=t.get(s-1,i+1);if(f!=null&&f.isEmpty()){e.set(s,i,(x=e.get(s-1,i+1))!=null?x:h.createVoid()),e.set(s-1,i+1,n);return}const p=t.get(s+1,i+1);if(p!=null&&p.isEmpty()){e.set(s,i,(m=e.get(s+1,i+1))!=null?m:h.createVoid()),e.set(s+1,i+1,n);return}if(n.type===l.SAND&&(o==null?void 0:o.type)===l.WATER){console.log("hola"),e.set(s,i,(M=e.get(s,i+1))!=null?M:o),e.set(s,i+1,n);return}if(n.type==l.WATER){const c=t.get(s-1,i),u=t.get(s+1,i);if((c==null?void 0:c.isEmpty())&&(u==null?void 0:u.isEmpty()))return;if(c!=null&&c.isEmpty()){e.set(s,i,(E=e.get(s-1,i))!=null?E:h.createVoid()),e.set(s-1,i,n);return}if(u!=null&&u.isEmpty()){e.set(s,i,(y=e.get(s+1,i))!=null?y:h.createVoid()),e.set(s+1,i,n);return}}e.get(s,i)==null&&e.set(s,i,n)}),e}}class h{constructor(t){r(this,"type");this.type=t}isEmpty(){return this.type===l.VOID}static createVoid(){return new h(l.VOID)}copy(){return new h(this.type)}}var l=(a=>(a[a.VOID=0]="VOID",a[a.SAND=1]="SAND",a[a.WATER=2]="WATER",a))(l||{});H();
